function createPostInit(e,t){t.createPost={removeOptionBtnHtml:'<a class="create-post__remove-post-option js-remove-post-option"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0" y="0" viewBox="0 0 24 24" xml:space="preserve" width="24px" height="24px" class="cross-icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/svg/common-icons-sprite.svg#cross-icon"></use></svg></a>',correctChoiceBtnHtml:"<a></a>",getSubScribedExams:function(){return e.ajax({method:"POST",url:"/user/getSubscribedExamGroupsOfUser",headers:{ismobile:!0},dataType:"json",contentType:"application/json"})},getSubjectsOfExam:function(t){return e.ajax({method:"POST",url:"/groups/getAllSubjectsOfGroup",data:getJSON(t),headers:{ismobile:!0},dataType:"json",contentType:"application/json"})},submitPost:function(){return e.ajax({method:"POST",url:"/posts/submitUserPost",data:getJSON(createPost.post),headers:{ismobile:!0},dataType:"json",contentType:"application/json"})},getPostById:function(t){return e.ajax({method:"GET",url:"/api/post/"+t,dataType:"json",contentType:"application/json"})},postType:{query:{postType:"text",subCategory:"doubt"},mcq:{postType:"poll",subCategory:"question",type:"text"},info:{postType:"text",subCategory:"studyTips"}}},e(document).on("click",".js-open-create-post",openCreatePost),e(document).on("click",".js-close-create-post",discardPost),e(document).on("click",".js-post-type",changePostType),e(document).on("click",".js-add-option",addPostOption),e(document).on("click",".js-remove-post-option",removePostOption),e(document).on("keyup",".js-post-type-query textarea",handleNextBtnState),e(document).on("keyup",".js-post-type-info textarea",handleNextBtnState),e(document).on("keyup",".js-post-type-mcq textarea",handleNextBtnState),e(document).on("keyup",".js-post-type-mcq .create-post__content-option-text",handleNextBtnState),e(document).on("click",".js-select-exam-to-post",showExamsToSelect),e(document).on("keyup",".search-exam__input",searchExams),e(document).on("click",".js-clear-search-exam",clearSearchExams),e(document).on("click",".js-select-item",selectItemOfGroup),e(document).on("click",".js-select-correct-option a",selectCorrectOption),e(document).on("click",".js-select-exam-next-btn",showSubjectToSelect),e(document).on("click",".js-submit-post",submitPost),e(document).on("click",".js-back-create-post",backToCreatePost),e(document).on("click",".js-back-select-exam-for-post",backToSelectExam),e(document).on("click",".js-cancel-discard-post",closeModal),e(document).on("click",".js-discard-post",function(){closeModal(".discard-post"),closeModal(".create-post")}),e(document).on("change",".ajax-image-upload__file-post",ajaxUploadPostImage),e(document).on("click",".ajax-image-upload-prev-post--remove",removePostImagePreview),e(document).on("click",".js-mobile-select-post-type .js-post-type",handleMobileCreatePost)}function openCreatePost(e){createPost.currentPostType="",createPost.post={groupId:"",groupName:"",subject:"",postType:"",location:"",lat:"0.0",long:"0.0",postUserMentions:"[]",postText:{},locationOn:!1,autoPost:!1,noLog:!1,dontKnow:!1};var t=$(".js-create-post-html").html();openModal(t,"create-post")}function discardPost(e){if(checkEmptyModalValues())return void closeModal();var t=$(".modal .discard-post-card").clone();if(0===t.length)return void closeModal();t.removeClass("hidden");var s=t.wrap("<p>").parent().html();openModal(s,"discard-post")}function checkEmptyModalValues(){if(createPost&&""===createPost.currentPostType)return!0;for(var e=$(".modal .js-post-type-"+createPost.currentPostType).find("input , textarea"),t=!1,s=0;s<e.length;s++)if(""!=e[s].value.trim()){t=!0;break}return!(t||createPost.post.postText&&Object.keys(createPost.post.postText).length>0)}function changePostType(e){var t=$(this),s=$(this).closest(".create-post").find(".create-post__message"),o=$(".modal .js-show-next");if(!t.hasClass("active")){o.hasClass("hidden")&&o.removeClass("hidden");var a=t.attr("data-type");createPost.currentPostType=a;var n=$(this).closest(".js-select-post-type"),r=n.parent(),i=n.find(".active"),c=i.attr("data-type");i.removeClass("active"),t.addClass("active"),r.find(".js-post-type-"+c).addClass("hidden"),r.find(".js-post-type-"+a).removeClass("hidden"),s.addClass("hidden").find("span").text(""),handleNextBtnState()}}function checkInputs(){var e={valid:!1,message:""},t=$(".modal.create-post .create-post");if("query"===createPost.currentPostType){var s=t.find(".js-post-type-query textarea");return""===s.val().trim()||s.val().length<5?(e.message="Post should contain at least 5 characters",e):(e.valid=!0,e)}if("info"===createPost.currentPostType){var s=t.find(".js-post-type-info textarea");return""===s.val().trim()||s.val().length<5?(e.message="Post should contain at least 5 characters",e):(e.valid=!0,e)}if("mcq"===createPost.currentPostType){var s=t.find(".js-post-type-mcq textarea"),o=t.find(".create-post__content-option"),a=Array.from(o).reduce(function(e,t){return e.push($(t).find("input").val().trim()),e},[]);if(""===s.val().trim()||s.val().length<5)return e.message="Question should contain at least 5 characters",e;var n=a.reduce(function(e,t){return!t||e},!1);return n?(e.message="Please provide options correctly",e):checkDuplicateInArr(a)?(e.message="Options should be unique",e):(e.valid=!0,e)}return e}function handleNextBtnState(){var e=$(".modal.create-post .create-post"),t=e.find(".js-create-post-next-btn"),s=checkInputs();return isMobile&&e.find(".post-type-active--open").length&&closeCreatePostTypeOptions(e.find(".post-type-active")),s.valid?($(t).parent().find(".create-post__message").hasClass("hidden")||$(t).parent().find(".create-post__message").addClass("hidden"),void t.addClass("active")):($(t).parent().find(".create-post__message").hasClass("hidden")||$(t).parent().find(".create-post__message").find("span").text(s.message),void t.removeClass("active"))}function checkDuplicateInArr(e){return e.reduce(function(e,t){return e.arr.indexOf(t)!==-1&&(e.isDuplicate=!0),e.arr.push(t),e},{arr:[],isDuplicate:!1}).isDuplicate}function addPostOption(e){$(this).prev().find(".js-remove-post-option").remove();var t,s=$(this).prev().clone(),o=s.find("label"),a=s.find("input"),n=$(this).closest(".js-post-type-mcq").find(".js-select-correct-option"),r=String.fromCharCode(o.text().charCodeAt(0)+1);o.text(r),a.val(""),s.find(".js-remove-post-option").remove(),s.find(".create-post__content-option-group").append(createPost.removeOptionBtnHtml),$(this).before(s);var i=$(createPost.correctChoiceBtnHtml);i.text(r),n.find(".dont-know").before(i),t=$(this).parent().find(".create-post__content-option").length,a.attr("placeholder","Option "+t),handleNextBtnState(),t<5||$(this).removeClass(".js-add-option").addClass("hidden")}function removePostOption(e){var t=$(this).closest(".js-post-option").prev(),s=$(this).closest(".js-post-type-mcq").find(".js-select-correct-option"),o=$(this).closest(".create-post__content-options"),a=o.find(".js-add-option");$(this).closest(".js-post-option").remove(),s.find(".dont-know").prev().remove(),o.find(".create-post__content-option").length>2&&t.find(".create-post__content-option-group").append(createPost.removeOptionBtnHtml),a.removeClass("hidden"),handleNextBtnState()}function showExamsToSelect(e){var t=$(this).closest(".create-post-container"),s=t,o=$(this).closest(".create-post"),a=o.find(".create-post__message"),n=t.find(".select-exam"),r=checkInputs();if(isMobile&&o.find(".post-type-active--open").length&&closeCreatePostTypeOptions(o.find(".post-type-active")),!r.valid)return void a.removeClass("hidden").find("span").text(r.message);savePostData();var i="";showLoader(s),createPost.getSubScribedExams().done(function(e){return e.error?void console.log(e):(i=getExamsToSelectHtml(e),t.find(".js-select-exam .select-group-container").html(i),o.addClass("hidden"),o.parent().find(".ajax-image-upload-prev").addClass("hidden"),n.removeClass("hidden"),void hideLoader(s))}).fail(function(e){hideLoader(s),console.log(e)})}function backToSelectExam(e){var t=$(this).closest(".create-post-container"),s=t.find(".js-select-subject"),o=t.find(".js-select-exam");s.addClass("hidden"),s.find(".create-post__message").addClass("hidden"),s.find(".js-submit-post").removeClass("active"),o.removeClass("hidden")}function clearSearchExams(e){$(this).closest(".select-exam__search").find(".search-exam__input").val(""),searchExams.call(this,e)}function searchExams(e){for(var t=$(this).closest(".js-select-exam").find(".js-select-item"),s=$(this).closest(".js-select-exam").find(".select-group"),o=$(this).closest(".select-exam__search").find(".search-exam__input").val().trim().toLowerCase(),a=0;a<t.length;a++)$(t[a]).find(".select-group__item-name")[0].innerText.toLowerCase().indexOf(o)!=-1?$(t[a]).removeClass("hidden"):$(t[a]).addClass("hidden");for(var a=0;a<s.length;a++)$(s[a]).find(".js-select-item.hidden").length===$(s[a]).find(".js-select-item").length?$(s[a]).addClass("hidden"):$(s[a]).removeClass("hidden");s.length===$(this).closest(".js-select-exam").find(".select-group.hidden").length?$(this).closest(".js-select-exam").find(".select-group__no-items").removeClass("hidden"):$(this).closest(".js-select-exam").find(".select-group__no-items").addClass("hidden"),o.length>0?$(this).closest(".select-exam__search").find(".select-exam__clear-btn").removeClass("hidden"):$(this).closest(".select-exam__search").find(".select-exam__clear-btn").addClass("hidden")}function getExamsToSelectHtml(e){var t="";return $.each(e,function(e,s){t+='<div class="select-group">',t+='<div class="flex-box flex-row"><h1 class="select-group__name">'+s.examname+"</h1>",t+='</div><div class="select-group__items flex-row flex-box">',t+=s.groups.reduce(function(e,t){return e+='<a class="select-group__item js-select-item flex-row flex-box" data-id="'+t.groupid+'" data-name="'+t.groupname+'">',e+='<span class="select-group__item-pic">',e+=t.grouppic?'<img src="'+t.grouppic+'" alt="'+t.groupname+'">':'<img src="'+defaultExamImgUrl+'" alt="'+t.groupname+'">',e+='</span><p class="select-group__item-name ',isMobile&&(e+=" overflow-ellipsis "),e+='">'+t.groupname+"</p>",e+='<span class="select-group__item-state"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0" y="0" viewBox="0 0 32 24" xml:space="preserve" width="25px" height="25px" class="tick-icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/svg/common-icons-sprite.svg#tick-icon"></use></svg></span></a>'},""),t+="</div></div>"}),t+='<div class="select-group__no-items hidden"><div class="flex-box flex-row"><h1 class="select-group__name">No Result Found. Please Try Something Else.</h1></div></div>'}function backToCreatePost(e){var t=$(this).closest(".create-post-container"),s=t.find(".select-exam"),o=t.find(".create-post");s.addClass("hidden"),s.find(".create-post__message").addClass("hidden"),s.find(".js-select-exam-next-btn").removeClass("active"),o.removeClass("hidden"),o.parent().find(".ajax-image-upload-prev").removeClass("hidden")}function showSubjectToSelect(e){var t=$(this).closest(".js-select-exam"),s=t.find(".select-group__item--selected").attr("data-id"),o=$(this).closest(".create-post-container"),a=t.find(".create-post__message"),n=o.find(".js-select-subject");if(!Boolean(s)){var r="Please select an Exam";return void a.removeClass("hidden").find("span").text(r)}var i="";saveChosenExam(),showLoader(o),createPost.getSubjectsOfExam({groupId:s}).done(function(e){i+='<div class="select-group"><div class="flex-box flex-row"><h1 class="select-group__name">Subjects</h1></div><div class="select-group__items flex-row flex-box">',$.each(e,function(e,t){$.each(t,function(e,t){i+='<a class="select-group__item flex-row js-select-item flex-box" data-id="'+t.id+'" data-name="'+t.name+'">',i+='<span class="select-group__item-pic">',i+=t.subjectPic?'<img src="'+t.subjectPic+'" alt="'+t.name+'">':'<img src="'+defaultSubjectImgUrl+'" alt="'+t.name+'">',i+='</span><p class="select-group__item-name ',isMobile&&(i+=" overflow-ellipsis "),i+='">'+t.name+"</p>",i+='<span class="select-group__item-state"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0" y="0" viewBox="0 0 32 24" xml:space="preserve" width="25px" height="25px" class="tick-icon">\t\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/svg/common-icons-sprite.svg#tick-icon"></use></svg></span></a>'})}),i+="</div></div>",n.find(".select-group-container").html(i),t.addClass("hidden"),n.removeClass("hidden"),hideLoader(o)}).fail(function(e){console.log(e)})}function savePostData(){var e=createPost.currentPostType,t=createPost.post;t.postText||(t.postText={});var s=$(".modal.create-post .create-post-container");if("query"===e||"info"===e)return t.postType=createPost.postType[e].postType,t.postText.subCategory=createPost.postType[e].subCategory,t.postText.postText=s.find('textarea[name="'+e+'"]').val(),void(t.postText.title=t.postText.postText.substring(0,100));if("mcq"===e){t.postType=createPost.postType[e].postType,t.postText.subCategory=createPost.postType[e].subCategory,t.postText.type=createPost.postType[e].text,t.postText.content=s.find('textarea[name="'+e+'"]').val();var o=s.find(".js-post-option");t.postText.choices=Array.from(o).reduce(function(e,t){return e.push($(t).find("input").val()),e},[]),t.postText.title=t.postText.content.substring(0,100),t.postText.postCorrected=!1,t.postText.correctOptionIndex=-1;var a=s.find(".js-select-correct-option .active");a.length>0&&(a.hasClass("dont-know")?t.dontKnow=!0:t.postText.correctOptionIndex=a.index()-1)}}function saveChosenExam(){var e=$(".modal.create-post .create-post-container"),t=createPost.post,s=e.find(".js-select-exam .select-group__item--selected");t.groupId=s.attr("data-id"),t.groupName=s.attr("data-name")}function saveChosenSubject(){var e=$(".modal.create-post .create-post-container"),t=createPost.post,s=e.find(".js-select-subject .select-group__item--selected");t.subject={},t.subject[s.attr("data-id")]=s.attr("data-name")}function submitPost(e){var t=$(this).parent().find(".create-post__message"),s=$(this).closest(".js-select-subject"),o=s.parent();if(0===s.find(".select-group__item--selected").length){var a="Please select a subject";return void t.removeClass("hidden").find("span").text(a)}saveChosenSubject(),showLoader(o),createPost.post&&createPost.post.postText&&createPost.post.postText.postText&&(createPost.post.postText.postText=createPost.post.postText.postText.replace(/(\n){1,}/g,"<br>")),createPost.submitPost().then(function(e){return e.error?204===e.errorCode?verifyUserUsingAccKit():$.Deferred().reject(e):e}).then(function(e){return e.error||e.status&&"error"===e.status?406===e.errorCode?$.Deferred().reject(e):$.Deferred().reject(e):e.postId?e:createPost.submitPost()}).then(function(e){return e=e||{},e.error?$.Deferred().reject(e):e.postId?createPost.getPostById(e.postId):void 0}).then(function(e){var t;if($.each(dataLayer,function(e,s){if("pageName"in s)return void(t=s.pageName)}),"homeLoggedIn"===t||window.location.pathname.match(/^\/me/g)&&1===window.location.pathname.match(/^\/me/g).length&&"myPosts"===$(".feeds__nav-link--active").attr("data-type")){var s=$(".js-feeds");s&&(s.prepend(getFeedsDOM({feeds:[e]})),storePost(e),closeAllModal(),$("body, html").animate({scrollTop:0},500))}closeAllModal(),createToast({closeButton:!0,message:"Post has been created!"})}).fail(function(e){var s=e.error?e.error:"Something went wrong :(";406===e.errorCode&&(s="Mobile number already registred",openModal(getAlreadyVerifedMobileHtml(e),"popup")),t.removeClass("hidden").find("span").text(s)}).always(function(){hideLoader(o)})}function selectItemOfGroup(e){if(!$(this).hasClass("select-group__item--selected")){var t=$(this).closest(".select-group-container");t.find(".select-group__item--selected").removeClass("select-group__item--selected"),$(this).addClass("select-group__item--selected"),handleSelectionOfItemOfGroup.bind(this)()}}function handleSelectionOfItemOfGroup(){var e;(e=$(this).closest(".js-select-exam")).length&&!e.hasClass("hidden")?(e.find(".create-post__message").addClass("hidden"),e.find(".js-select-exam-next-btn").addClass("active")):(e=$(this).closest(".js-select-subject")).length&&!e.hasClass("hidden")&&(e.find(".create-post__message").addClass("hidden"),e.find(".js-submit-post").addClass("active"))}function selectCorrectOption(e){if($(this).hasClass("active"))return void $(this).removeClass("active");var t=$(this).closest(".js-select-correct-option");t.find(".active").removeClass("active"),$(this).addClass("active")}function ajaxUploadPostImage(e){var t=$(this).closest(".ajax-image-upload-container").find(".ajax-image-upload-prev"),s=$(this).closest(".ajax-image-upload-form-post");if(this.files&&this.files[0]){var o=new FileReader;o.onload=function(e){t.length>0&&(t.find("img").attr("src",e.target.result),t.find(".image-link").attr("href",e.target.result),t.removeClass("hidden")),$(s).attr("onsubmit","return createPostContentImageForm(event)"),$(s).submit()},o.readAsDataURL(this.files[0])}}function removePostImagePreview(e){var t=$(this).closest(".ajax-image-upload-container").find(".ajax-image-upload-prev");t.find("img").attr("src",""),t.find(".image-link").attr("href",""),t.find(".ajax-image-upload-prev__message").text(""),t.addClass("hidden");var s=$(this).closest(".ajax-image-upload-container").find(".ajax-image-upload-form-post .ajax-image-upload__file-post");1==s.length&&s.val("");var o=$(this).closest(".ajax-image-upload-container").find(".create-post");hideLoader(o),delete createPost.post.postText.imageAspectRatio,delete createPost.post.postText.imageURL,delete createPost.post.postText.imageWidth}function handleMobileCreatePost(e){var t,s=$(this);return s.closest(".create-post__select-post-type").addClass("post-type-active--selected"),s.hasClass("post-type-active")&&(s.addClass("post-type-active--open"),t=s.closest(".js-select-post-type").find("> .post-type-hidden"),t.length)?void $.each(t,function(e,t){$(t).hasClass("post-type-active")||$(t).removeClass("post-type-hidden")}):void closeCreatePostTypeOptions(s)}function closeCreatePostTypeOptions(e){var t=e.closest(".js-select-post-type").find(".create-post__select-post-type-btn");$.each(t,function(e,t){$(t).addClass("post-type-hidden"),$(t).removeClass("post-type-active post-type-active--open"),$(t).removeAttr("style")}),e.addClass("post-type-active"),e.removeClass("post-type-hidden"),e.css("order","-1")}$(document).ready(createPostInit(jQuery,window));var defaultExamImgUrl="https://gs-post-images.grdp.co/2016/11/img1479546480066-36-rs.png",defaultSubjectImgUrl="https://gs-post-images.grdp.co/2016/11/img1479545029818-31-rs.png",isMobile=Boolean($(".js-open-drawer").length),createPostContentImageForm=function(e){var t=$(e.target).closest(".create-post");return showLoader(t),submitPostContentImageForm(e).then(function(e){var s=t.find(".ajax-image-upload-form-post .ajax-image-upload__file-post");return 1!=s.length||""==s.val()?$.Deferred().reject({error:"Interrupted Uploading"}):void(createPost.post&&createPost.post.postText&&Object.assign(createPost.post.postText,e.imageDetails))}).fail(function(e){console.log(e)}).always(function(){hideLoader(t)}),!1};//# sourceMappingURL=create-post-5f697bb5f7.js.map
