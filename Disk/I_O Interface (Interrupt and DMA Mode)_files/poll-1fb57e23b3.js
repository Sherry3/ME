"use strict";!function(){function t(t){var e=$(this),a=e.closest(".post__comment-reply");a&&1===a.length?(commentPollData.pollIn="reply",commentPollData.commentId=e.closest(".post__comment").attr("data-comment-id")):commentPollData.pollIn="comment";var l=e.closest(".post"),n=l.attr("data-id");v=getPostById(n),v&&v.postid||(v={groupid:l.attr("data-groupid"),groupname:l.attr("data-groupname"),postid:n,subj:parseJSON(l.attr("data-subj"))}),o();var s=$(".js-create-poll-html").html();a&&1===a.length&&(s=s.replace(/(Create a poll comment)/g,"Create a poll reply"),s=s.replace(/(Post a comment MCQ)/g,"Post a reply MCQ")),openModal(s,"create-poll create-post")}function o(){commentPollData.post={autoPost:"true",dontKnow:"false",groupId:v.groupid,groupName:v.groupname,lat:"0.0",location:"",locationOn:"true",long:"0.0",noLog:"true",postText:{},postType:"chat_poll",subject:JSON.stringify(v.subj),postUserMentions:"[]"},commentPollData.comment={},commentPollData.reply={}}function e(t){if(r())return void closeAllModal();var o=$(".modal .discard-poll-card").clone();if(0===o.length)return void closeAllModal();o.removeClass("hidden");var e=o.wrap("<p>").parent().html();openModal(e,"discard-poll")}function a(t){var e=$(".modal.create-poll"),a=e.find(".js-submit-poll-data"),m=$(a).parent().find(".create-poll__message"),c=i();if(c.valid){var r=e.find(".create-post-container");return showLoader(r),l(),void commentPollData.submitCommentPoll().then(function(t){if(t.error)return m.removeClass("hidden").find("span").text(t.error),o(),$.Deferred().reject(t);switch(commentPollData.pollIn){case"reply":return s(t),postService().handleCommentReplyRequest(commentPollData.reply);case"comment":return n(t),postService().handlePostCommentRequest(commentPollData.comment)}}).then(function(t){if(hideLoader(r),t.error)return m.removeClass("hidden").find("span").text(t.error),o(),$.Deferred().reject(t);closeAllModal();var e=$('.post[data-id="'+v.postid+'"]');switch(commentPollData.pollIn){case"reply":var a=e.find('.post__comment[data-comment-id="'+commentPollData.commentId+'"]'),l=a.find(".post__replies"),n=getReplyPollsHtml(t);l.append(n);var s=a.find(".post__comment__reply-count");return void s.html(parseInt(s.html())+1);case"comment":var c=e.find(".post__comments"),n=getPollsHtml(t);c.append(n);var i=e.find(".post__comments-count"),p=parseInt(i.html())+1;return void i.html(p+(1===p?" comment":" comments"))}}).fail(function(t){hideLoader(r);var e=t.error||"Some error occured";o(),m.removeClass("hidden").find("span").text(e)})}return void(m.hasClass("hidden")?m.removeClass("hidden").find("span").text(c.message):m.find("span").text(c.message))}function l(){commentPollData.post.postText.imageAspectRatio="0.0",commentPollData.post.postText.imageWidth="0",commentPollData.post.postText.postCorrected=!1,commentPollData.post.postText.subCategory="question",commentPollData.post.postText.type="text",commentPollData.post.postText.correctOptionIndex=-1;var t=$(".modal.create-poll .create-poll-container");commentPollData.post.postText.content=t.find("textarea").val().replace(/\n/g,"<br>"),commentPollData.post.postText.title=commentPollData.post.postText.content.substring(0,100);var o=t.find(".js-poll-option");commentPollData.post.postText.choices=Array.from(o).reduce(function(t,o){return t.push($(o).find("input").val()),t},[]);var e=t.find(".js-poll-select-correct-option .active");e.length>0&&(e.hasClass("dont-know")?commentPollData.post.dontKnow="true":commentPollData.post.postText.correctOptionIndex=e.index()-1),commentPollData.post.postText=JSON.stringify(commentPollData.post.postText)}function n(t){var o=parseJSON(commentPollData.post.postText);commentPollData.comment.autoComment=!1,commentPollData.comment.commentData=o.content,commentPollData.comment.commentType="poll",commentPollData.comment.commentUserMentions={},commentPollData.comment.commentUserMentions.userList=parseJSON(commentPollData.post.postUserMentions),commentPollData.comment.postId=v.postid,commentPollData.comment.groupId=commentPollData.post.groupId,commentPollData.comment.metadata={},commentPollData.comment.metadata.imageAspectRatio=o.imageAspectRatio,commentPollData.comment.metadata.imageWidth=o.imageWidth,commentPollData.comment.metadata.imageURL=o.imageURL,commentPollData.comment.metadata.pollData={attemptCount:0,clickedOptionIndex:-1,correctOptionIndex:o.correctOptionIndex,isAttempted:!1,isDataObtained:!1,isResultShown:!1,isSubmitted:!1,optionsArrayList:o.choices,optionsMarkedCount:[],pollId:t.postId,subCategory:"question"},commentPollData.comment.metadata.pollData=JSON.stringify(commentPollData.comment.metadata.pollData)}function s(t){var o=parseJSON(commentPollData.post.postText);commentPollData.reply.commentid=commentPollData.commentId,commentPollData.reply.type="poll",commentPollData.reply.data=o.content,commentPollData.reply.mentions=[],commentPollData.reply.mentions=parseJSON(commentPollData.post.postUserMentions),commentPollData.reply.postid=v.postid,commentPollData.reply.meta={},commentPollData.reply.meta.imageAspectRatio=o.imageAspectRatio,commentPollData.reply.meta.imageWidth=o.imageWidth,commentPollData.reply.meta.imageURL=o.imageURL;var e={attemptCount:0,clickedOptionIndex:-1,correctOptionIndex:o.correctOptionIndex,isAttempted:!1,isDataObtained:!1,isResultShown:!1,isSubmitted:!1,optionsArrayList:o.choices,optionsMarkedCount:[],pollId:t.postId,subCategory:"question"};commentPollData.reply.meta.pollData=JSON.stringify(e)}function m(){if($(this).hasClass("active"))return void $(this).removeClass("active");var t=$(this).closest(".js-poll-select-correct-option");t.find(".active").removeClass("active"),$(this).addClass("active")}function c(){var t=$(".modal.create-poll"),o=t.find(".js-submit-poll-data"),e=$(o).parent().find(".create-poll__message"),a=i();return a.valid?(e.hasClass("hidden")||e.addClass("hidden"),void o.addClass("active")):(e.hasClass("hidden")||e.find("span").text(a.message),void o.removeClass("active"))}function r(){for(var t=$(".modal.create-poll .js-poll-mcq").find("input , textarea"),o=!1,e=0;e<t.length;e++)if(""!=t[e].value.trim()){o=!0;break}return!o}function i(){var t={valid:!1,message:""},o=$(".modal.create-poll"),e=o.find(".js-poll-mcq textarea"),a=o.find(".create-poll-option"),l=Array.from(a).reduce(function(t,o){return t.push($(o).find("input").val().trim()),t},[]);if(""===e.val().trim()||e.val().length<5)return t.message="Question should contain at least 5 characters",t;var n=l.reduce(function(t,o){return!o||t},!1);return n?(t.message="Please provide options correctly",t):checkDuplicateInArr(l)?(t.message="Options should be unique",t):(t.valid=!0,t)}function p(t){$(this).prev().find(".js-poll-remove-option").remove();var o,e=$(this).prev().clone(),a=e.find("label"),l=e.find("input"),n=$(this).closest(".js-poll-mcq").find(".js-poll-select-correct-option"),s=String.fromCharCode(a.text().charCodeAt(0)+1);a.text(s),l.val(""),e.find(".js-poll-remove-option").remove(),e.find(".create-poll-option-group").append(commentPollData.removeOptionBtnHtml),$(this).before(e);var m=$(commentPollData.correctChoiceBtnHtml);m.text(s),n.find(".dont-know").before(m),o=$(this).parent().find(".create-poll-option").length,l.attr("placeholder","Option "+o),c(),o<5||$(this).removeClass(".js-poll-add-option").addClass("hidden")}function d(t){var o=$(this).closest(".js-poll-option").prev(),e=$(this).closest(".js-poll-mcq").find(".js-poll-select-correct-option"),a=$(this).closest(".create-poll-options"),l=a.find(".js-poll-add-option");$(this).closest(".js-poll-option").remove(),e.find(".dont-know").prev().remove(),a.find(".create-poll-option").length>2&&o.find(".create-poll-option-group").append(commentPollData.removeOptionBtnHtml),l.removeClass("hidden"),c()}var u=!1;$('input[name="userLoggedIn"]').length>0&&(u=!0),u?($(document).on("click",".js-open-create-poll",t),$(document).on("click",".js-submit-poll-data",a)):$(document).on("click",".js-open-create-poll",showAuthLogin),$(document).on("click",".js-close-create-poll",e),$(document).on("keyup",".js-poll-mcq textarea , .js-poll-mcq input",c),$(document).on("click",".js-poll-add-option",p),$(document).on("click",".js-poll-select-correct-option a",m),$(document).on("click",".js-poll-remove-option",d),$(document).on("click",".js-cancel-discard-poll",closeModal),$(document).on("click",".js-discard-poll",function(){closeModal(".discard-poll"),closeModal(".create-poll")}),window.discardCommentPoll=e,window.commentPollData={removeOptionBtnHtml:'<a class="create-post__remove-post-option js-poll-remove-option"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0" y="0" viewBox="0 0 24 24" xml:space="preserve" width="24px" height="24px" class="cross-icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/svg/common-icons-sprite.svg#cross-icon"></use></svg></a>',correctChoiceBtnHtml:"<a></a>",submitCommentPoll:function(){return $.ajax({method:"POST",url:"/posts/submitUserPost",data:getJSON(commentPollData.post),headers:{ismobile:!0},dataType:"json",contentType:"application/json"})},post:{},comment:{},reply:{},deleteImageDetails:function(){delete commentPollData.post.postText.imageAspectRatio,delete commentPollData.post.postText.imageWidth,delete commentPollData.post.postText.imageURL}};var v}();//# sourceMappingURL=poll-1fb57e23b3.js.map
