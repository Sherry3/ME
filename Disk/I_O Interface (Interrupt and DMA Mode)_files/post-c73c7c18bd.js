"use strict";$(document).ready(function(){function e(e){var s=$(this),o=s.closest(".js-test-question"),n=o.index(),i=s.parent().index(),a=w.questions[n],c="";if(x.indexOf(a.questionId)===-1){c=a.correctChoice===i?"correct":"incorrect",x.push(a.questionId),C+=Math.abs(a.positiveMarks)-Math.abs(a.negativeMarks),_.responses[n].questionId===a.questionId&&_.responses[n].optionSelected.push(i),"correct"===c&&(s.parent().addClass("post__question-option--correct"),s.removeClass("js-test-option")),"incorrect"===c&&(s.parent().addClass("post__question-option--incorrect"),s.removeClass("js-test-option"),o.find(".post__question-option").eq(a.correctChoice).addClass("post__question-option--correct"));var l=t(c,a.solution);l=$("<div></div>").html(l).find(".post__question-solution").hide().parent().html(),o.append(l),o.find(".post__question-solution").slideDown(),gaPush({eventCategory:"Question Attempted",eventAction:"1",eventLabel:w.subject}),1===x.length&&gaPush({eventCategory:"quiz",eventAction:"attempted atleast 1 qn",eventLabel:w.subject}),w.questions.length===x.length&&r()}}function t(e,t){var s="",o="",n="";return"correct"===e?(s="rocket-green",o='<span class="flex-box flex-row status-icon"><svg height="15px" version="1.1" viewBox="0 0 32 24" width="17px" x="0" xmlns="http://www.w3.org/2000/svg" y="0" class="tick-icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/svg/common-icons-sprite.svg#tick-icon"></use></svg></span><span>Correct answer</span>'):"incorrect"===e&&(s="google-red",o='<span class="flex-box flex-row status-icon"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0" y="0" viewBox="0 0 24 24" xml:space="preserve" width="15px" height="15px" class="cross-icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/svg/common-icons-sprite.svg#cross-icon"></use></svg></span><span>Oops! Wrong answer!</span>'),n='<div class="post__question-solution very-light-grey-bg">',"correct"!==e&&"incorrect"!==e||(n+='<p class="post__question-status post__question-status--'+e+" semi-bold-font "+s+' flex-box flex-row">'+o+"</p>"),t&&(n+='<p class="post__question-solution__text semi-bold-font">'+t+"</p>"),n+="</div>",n+='<a class="js-report-question report-question text-underline text-underline-hover"> Report </a>'}function s(e,t){return e=e||{},t=t||{},'<div class="safed-bg box-shadow"><div class="post__result-card"><h2 class="post__result-card__title">Quiz Completed</h2><div class="post__result-subCards safed-bg flex-box flex-row"><div class="post__result-subCard flex-box flex-column"><p class="post__result__subCard-text semi-bold-font">Score</p><p class="post__result__subCard-value sky-blue s-40 semi-bold-font">'+Math.round(e.score)+'</p><p class="post__result__subCard-info s-14 semi-bold-font">out of '+e.maxScore+'</p></div><div class="post__result-subCard flex-box flex-column"><p class="post__result__subCard-text semi-bold-font">Rank</p><p class="post__result__subCard-value sky-blue s-40 semi-bold-font">'+t.rank+'</p><p class="post__result__subCard-info s-14 semi-bold-font">out of '+t.total+'</p></div></div><div class="post__result-card__review-quiz light-grey">Review Quiz</div><div class="text-center"><div class="js-share-score-in-comments post__result__share rocket-green-bg safed upper-case">Share score in comments</div></div></div></div>'}function o(e){$("body, html").animate({scrollTop:0},500,function(){})}function n(){function e(e){m=e,u=null,d=[],p=[]}function t(){u=window.setInterval(o,1e3)}function s(){clearInterval(u)}function o(){return 0===m?void i():(c(),void m--)}function n(){var e=Math.floor(m/3600),t=Math.floor((m-3600*e)/60),s=m-3600*e-60*t;return s=Math.round(100*s)/100,{hours:e,minutes:t,seconds:s}}function i(){u&&clearInterval(u),c(),l()}function r(e){"function"==typeof e&&d.push(e)}function a(e){"function"==typeof e&&p.push(e)}function c(){d.forEach(function(e){"function"==typeof e&&e(n())})}function l(){p.forEach(function(e){"function"==typeof e&&e()})}var u,d,p,m=0;return{init:e,start:t,onTick:r,onComplete:a,stop:s}}function i(){$(".js-test-option").each(function(e,t){$(t).removeClass("js-test-option")}),$(".js-submit-quiz").removeClass("js-submit-quiz")}function r(){w.questions.length!==x.length?openModal('<div class="discard-post-card"><p>You haven\'t finished all the questions yet.</p><p>Are you sure you want to submit?</p><div class="discard-post-actions"><a class="discard-post-card__cancel-btn js-cancel-discard-post">CANCEL</a><a class="discard-post-card__discard-btn rocket-bg js-submit-quiz-data">SUBMIT</a></div></div>'):a()}function a(){closeModal(),f.stop(),$(".post__timer__head").addClass("hidden");var e=$(".js-submit-quiz"),t=$(".post__content").parent();w.questions.length!==x.length&&c(),showLoader($(".js-submit-quiz"),{height:"20px",width:"20px"}),g.submitTest({testResponse:_}).then(function(o){gaPush({eventCategory:"quiz",eventAction:"completed",eventLabel:w.subject});var n=$('.post[data-id="'+_.postId+'"]').find(".post__prop .post__attempt-count"),r=+n.find("span").text();n.html("<span>"+(r+1)+"</span>"+(1!=r?" attempts":" attempt")),i(),e.slideUp(400,function(){e.remove()});var a=$("<div></div>").html(s(o.score,o.rank)).find(".post__result-card").parent().hide().parent().html();t.after(a),t.parent().find(".post__result-card").parent().slideDown(400,function(){var e=$(".post__result-card").offset().top-100;$("body, html").animate({scrollTop:e},500,function(){})}),$(".related-posts").removeClass("hidden"),$(".post__comments").parent().removeClass("hidden"),q=!0}).fail(function(e){console.log(e)}).always(function(){hideLoader($(".js-submit-quiz"))})}function c(){w.questions.length!==x.length&&$(".post__question").each(function(e,s){var o,n=$(s),i=w.questions[e];x.indexOf(i.questionId)===-1&&(n.find(".post__question-option").eq(i.correctChoice).addClass("post__question-option--skipped"),i.solution&&(o=t("skipped",i.solution),n.append(o)))})}function l(e){var t=$(this).closest(".post").attr("data-id"),s=$(this).closest(".post").attr("data-groupid"),o=$(this).closest(".post__question"),n=o.index(),i=w.questions[n],r='<div class="report-question-card">';r+='<div class="flex-box flex-row u-margin-bottom-small"><h3 class="u-flex-grow">Report Question!</h3>',r+='<a class="close-report-question js-cancel-report-question"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0" y="0" viewbox="0 0 24 24" xml:space="preserve" width="24px" height="24px" class="cross-icon"><use xlink:href="/svg/common-icons-sprite.svg#cross-icon"></use></svg></a>',r+="</div>",r+='<input type="hidden" value="'+t+'" id="reportPostId">',r+='<input type="hidden" value="'+s+'" id="reportGroupId">',r+='<input type="hidden" value="'+i.questionId+'" id="reportQuesId">',r+='<div class="report-question-options">';var a=["Incorrect Question","Incorrect Answer","Incorrect Solution","Incomplete Solution"];$.each(a,function(e,t){r+='<div class="report-question-options__option flex-box flex-row js-select-report-ques-option">',r+='<div class="report-question-options__option--radio-btn round-radio-button"></div>',r+='<div class="report-question-options__option--text u-flex-grow">'+t+"</div>",r+="</div>"}),r+="</div>",r+='<input type="text" class="report-question-options__explain" placeholder="Explain Further">',r+='<div class="report-question-actions flex-box flex-row">',r+='<p class="report-question-error flex-box flex-row red u-flex-grow hidden"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0" y="0" viewBox="0 0 20 20" xml:space="preserve" width="20px" height="20px" class="error-icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/svg/common-icons-sprite.svg#error-icon"></use></svg><span>Please select a reason</span></p>',r+='<a class="medium-grey js-cancel-report-question">CANCEL</a>',r+='<a class="google-red-bg safed js-report-question-call">REPORT</a></div></div>',openModal(r,"report-question")}function u(e){$(this).closest(".report-question-options").find(".active").removeClass("active"),$(this).find(".report-question-options__option--radio-btn").addClass("active"),$(this).closest(".report-question-card").find(".report-question-actions").find(".report-question-error").addClass("hidden")}function d(e){var t=$(this).closest(".report-question-card").find("#reportPostId").val(),s=$(this).closest(".report-question-card").find("#reportGroupId").val(),o=Number($(this).closest(".report-question-card").find("#reportQuesId").val()),n=$(this).closest(".report-question-card").find(".report-question-options").find(".active").next().text();if(0==n.trim().length)return void $(this).closest(".report-question-actions").find(".report-question-error").removeClass("hidden");var i=$(this).closest(".report-question-card").find(".report-question-options__explain").val();i.trim().length>0&&(n+=" User Message : "+i),g.reportQuestion({postId:t,groupId:s,quesId:o,reason:n}).then(function(e){return e.error||e.errorCode?$.Deferred().reject(e):(createToast({closeButton:!0,message:"Thanks for reporting. Our team will take proper action!"}),void closeAllModal())}).fail(function(e){console.log(e)})}function p(e){var t=this;html2canvas($(".post").find(".post__result-card .post__result-subCards"),{onrendered:function(s){m.call(t,e),$("#targetCanvas").html(s)}})}function m(e){var t=$(this).closest(".post").attr("data-id"),s=$(this).closest(".post").attr("data-groupid"),o='<div class="share-score-comments" data-id="'+t+'" data-groupid="'+s+'">';o+='<div class="flex-box flex-row u-margin-bottom-small"><h3 class="u-flex-grow">Share your score!</h3>',o+='<a class="close-share js-cancel-share"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" x="0" y="0" viewbox="0 0 24 24" xml:space="preserve" width="24px" height="24px" class="cross-icon"><use xlink:href="/svg/common-icons-sprite.svg#cross-icon"></use></svg></a>',o+="</div>",o+='<div class="share-options">',o+='<div class="share-target" id="targetCanvas"></div>',o+='<input type="text" class="share-score-comments__explain" placeholder="Add Text (Optional)">',o+='<div class="share-score-comments__actions flex-box flex-row">',o+='<a class="medium-grey js-cancel-share">CANCEL</a>',o+='<a class="rocket-green-bg safed js-share-score-comments">POST</a></div></div>',o+="</div></div>",openModal(o)}function v(e){var t,s=this,o=$(this).closest(".share-score-comments").find("#targetCanvas").find("canvas")[0];o&&(showLoader($(s).closest(".share-score-comments")),o.toBlob(function(e){var o=new FormData;o.append("imageForPost",e,"share.png"),uploadPostContentImage(o,function(e){console.log("Sharing Score...")}).then(function(e){try{e=JSON.parse(e)}catch(t){console.log(t),e={}}return e.error?$.Deferred().reject(e):e.success?e:$.Deferred().reject("Error occured!")}).then(function(e){var t={autoComment:!0,commentType:"image",commentUserMentions:{userList:[]},metadata:{}};t.metadata=e.imageDetails;var o=$(s).closest(".share-score-comments").find("input"),n=$(s).closest(".share-score-comments");return t.groupId=n.attr("data-groupId"),t.postId=n.attr("data-id"),t.commentData=o.val().replace(/(\n){1,}/g,"<br>"),handlePostCommentRequest(t)}).then(function(e){var s;s=getCommentsHtml(e);var o=$("body").find(".post");o.find(".post__comments").append(s);var n=o.find(".post__comments-count"),i=parseInt(n.html())+1;n.html(i+(1===i?" comment":" comments")),t=e.commentid,createToast({closeButton:!0,message:"Score shared successfully!"})}).fail(function(e){"string"==typeof e?createToast({closeButton:!0,message:e}):e.responseJSON&&e.responseJSON.error?createToast({closeButton:!0,message:e.responseJSON.error}):createToast({closeButton:!0,message:"Error occured"})}).always(function(e){if(t){var o=$("body").find('.post__comment[data-comment-id="'+t+'"]');if(o){var n=o.offset().top-64;$("body, html").animate({scrollTop:n},500)}}closeModal(),hideLoader($(s).closest(".share-score-comments"))})},"image/png",1))}var h=!1;$('input[name="userLoggedIn"]').length>0&&(h=!0),h?($(document).on("click",".js-report-question",l),$(document).on("click",".js-select-report-ques-option",u),$(document).on("click",".js-report-question-call",d),$(document).on("click",".js-share-score-in-comments",p),$(document).on("click",".js-share-score-comments",v)):$(document).on("click",".post__question-option",function(){showAuthLogin()}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,s){for(var o=atob(this.toDataURL(t,s).split(",")[1]),n=o.length,i=new Uint8Array(n),r=0;r<n;r++)i[r]=o.charCodeAt(r);e(new Blob([i],{type:t||"image/png"}))}});var f,g={submitTest:function(e){return $.ajax({method:"POST",url:"/assessment/submitTest",data:getJSON(e),headers:{ismobile:!0},dataType:"json",contentType:"application/json"})},getRank:function(e){return $.ajax({method:"POST",url:"/assessment/getRank",data:getJSON(e),headers:{ismobile:!0},dataType:"json",contentType:"application/json"})},reportQuestion:function(e){return $.ajax({method:"POST",url:"/questions/reportWrongSolution",data:getJSON(e),headers:{ismobile:!0},dataType:"json",contentType:"application/json"})}},_={},x=[],w=$('input[name="testData"]').val(),q=!1;if($('input[name="testData"]').remove(),w){if(w=parseJSON(w),w.submitted){q=!0;var b={postId:w.postId,testId:w.testId,score:w.score},y=$(".js-rank"),k=$(".js-total");return void g.getRank(b).then(function(e){y.text(e.rank.rank),k.text("out of "+e.rank.total)}).fail(function(){console.log(resp)})}window.onbeforeunload=function(e){if(!q)return e=e||window.event,e&&(e.returnValue="Navigating Away from this page will loose your marked options. Please complete the test before you leave."),"Navigating Away from this page will loose your marked options. Please complete the test before you leave."},_.postId=w.postId,_.testId=w.testId,_.responses=[],w.questions=w.questions.map(function(e){return _.responses.push({optionSelected:[],questionId:e.questionId}),{correctChoice:+e.correctChoice,negativeMarks:+e.negativeMarks,positiveMarks:+e.positiveMarks,questionId:+e.questionId,solution:e.solution}});var C=0,j=w.timeLimit;f=n(),f.init(60*j),gaPush({eventCategory:"quiz",eventAction:"loaded successfully",eventLabel:w.subject}),$(document).on("click",".js-test-option",e),$(document).on("click",".js-submit-quiz",r),$(document).on("click",".js-submit-quiz-data",a),$(document).on("click",".post__result-card__review-quiz",o),$(document).scroll(function(){var e=$(document).find(".post--test");if(0!==e.length)if(window.scrollY>e.offset().top-$(".main-header").height()){var t={};t.element=$(".post__quiz-timer"),t.width=$(".post--test").width(),addStickyHeader(t)}else{var t={};t.element=$(".post__quiz-timer"),removeStickyHeader(t)}}),$(".post__quiz-timer").html(),f.onTick(function(e){var t=60*e.hours+e.minutes;t=t<10?"0"+t:""+t;var s=e.seconds<10?"0"+e.seconds:""+e.seconds,o=$(".post__quiz-timer");if(o.length){var n=o.find(".minutes"),i=o.find(".seconds");if(0===n.length&&0===i.length)return void o.html('<svg width="50" height="50" x="0" y="0" viewBox="0 0 56 56" xml:space="preserve" class="clock-icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/svg/clock-icon.svg#clock-icon"></use></svg><p class="post__quiz-time semi-bold-font">\tTime Left -<span class="minutes"> '+t+' </span><span> :</span><span class="seconds"> '+s+"</span><span> sec</span></p>");n.text(" "+t+" "),i.text(" "+s)}}),f.onComplete(a),f.start()}});
//# sourceMappingURL=post-c73c7c18bd.js.map
